var xhr,Home=location.href,xhrUrl="",Diaspora={L:function(t,e,a){if(t==xhrUrl)return!1;xhrUrl=t,xhr&&xhr.abort(),xhr=$.ajax({type:"GET",url:t,timeout:1e4,success:function(t){e(t),xhrUrl=""},error:function(e,r,i){"abort"==r?a&&a():window.location.href=t,xhrUrl=""}})},P:function(){return!!("ontouchstart"in window)},HS:function(t,e){var a=t.data("id")||0,r=t.attr("href"),i=t.attr("title")||t.text();$("#preview").length&&window.history&&history.pushState||(location.href=r),Diaspora.loading();var o={d:a,t:i,u:r};Diaspora.L(r,function(t){if($(t).filter("#single").length){switch(e){case"push":history.pushState(o,i,r);break;case"replace":history.replaceState(o,i,r)}switch(document.title=i,$("#preview").html($(t).filter("#single")),e){case"push":Diaspora.preview();break;case"replace":window.scrollTo(0,0),Diaspora.loaded()}}else location.href=r})},loading:function(){var t=window.innerWidth,e='<style class="loaderstyle" id="loaderstyle'+t+'">@-moz-keyframes loader'+t+"{100%{background-position:"+t+"px 0}}@-webkit-keyframes loader"+t+"{100%{background-position:"+t+"px 0}}.loader"+t+"{-webkit-animation:loader"+t+" 3s linear infinite;-moz-animation:loader"+t+" 3s linear infinite;}</style>";$(".loaderstyle").remove(),$("head").append(e),$("#loader").removeClass().addClass("loader"+t).show()},loaded:function(){$("#loader").removeClass().hide()},F:function(t,e,a){var r=$(t).parent().height(),i=$(t).parent().width(),o=a/e;r/i>o?(t.style.height=r+"px",t.style.width=r/o+"px"):(t.style.width=i+"px",t.style.height=i*o+"px"),t.style.left=(i-parseInt(t.style.width))/2+"px",t.style.top=(r-parseInt(t.style.height))/2+"px"}};$(function(){if(Diaspora.P()&&$("body").addClass("touch"),$("#preview").length){var t,e={};e.t=$("#cover"),e.w=e.t.attr("width"),e.h=e.t.attr("height"),(e.o=function(){$("#mark").height(window.innerHeight)})(),e.t.prop("complete")&&setTimeout(function(){e.t.load()},0),e.t.on("load",function(){(e.f=function(){var t,a,r,i,o=$("#mark").width(),n=$("#mark").height();i=o>=1e3||n>=1e3?1e3:500,o>=n?(r=o/i*50,a=r,t=r*o/n):(r=n/i*50,t=r,a=r*n/o),$(".layer").css({width:o+t,height:n+a,marginLeft:-.5*t,marginTop:-.5*a}),e.w||(e.w=e.t.width(),e.h=e.t.height()),Diaspora.F($("#cover")[0],e.w,e.h)})(),setTimeout(function(){$("html, body").removeClass("loading")},1e3),$("#mark").parallax();var t=new Vibrant(e.t[0]),a=t.swatches();a.DarkVibrant&&($("#vibrant polygon").css("fill",a.DarkVibrant.getHex()),$("#vibrant div").css("background-color",a.DarkVibrant.getHex())),a.Vibrant&&$(".icon-menu").css("color",a.Vibrant.getHex())}),e.t.attr("src")||alert("Please set the post thumbnail"),$(window).on("resize",function(){clearTimeout(t),t=setTimeout(function(){Diaspora.P()||location.href!=Home||(e.o(),e.f()),$("#loader").attr("class")&&Diaspora.loading()},500)})}else $("html, body").removeClass("loading")});