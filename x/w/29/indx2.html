<html><head><base href="https://%E4%B8%8B%E7%A7%BB%E5%BD%93%E5%89%8D%E8%A2%AB%E5%8F%AB%E4%BF%A1%E6%81%AF%EF%BC%8C%E8%AE%A9%E9%A1%B5%E9%9D%A2%E6%9B%B4%E5%8A%A0%E7%BE%8E%E8%A7%82%E3%80%82">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>双恒网络源码网叫号系统</title>
<link href="/all.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.css" rel="stylesheet" />
<style>
    body {
        font-family: 'Arial', sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
    }
    .left-panel, .right-panel {
        padding: 20px;
        box-sizing: border-box;
    }
    .left-panel {
        width: 60%;
        background-color: white;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
    }
    .right-panel {
        width: 40%;
        background-color: #ecf0f1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }
    h1, h2 {
        color: #2c3e50;
        text-align: center;
    }
    .current-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-grow: 1;
    }
    #currentPerson {
        font-size: 120px;
        color: #3498db;
        margin: 20px 0;
        text-align: center;
        word-wrap: break-word;
        max-width: 100%;
    }
    #currentPerson .label {
        font-size: 60px;
        color: #2c3e50;
    }
    #nextPerson {
        font-size: 40px;
        margin: 10px 0;
        text-align: center;
    }
    #nextPerson .next-name {
        color: #f39c12;
    }
    .button-group {
        display: flex;
        justify-content: center;
        margin-top: 20px;
        flex-wrap: wrap;
    }
    button {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 15px;
        font-size: 20px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin: 5px;
        border-radius: 50%;
        width: 50px;
        height: 50px;
    }
    button:hover {
        background-color: #2980b9;
    }
    #shuffleButton {
        background-color: #2ecc71;
    }
    #shuffleButton:hover {
        background-color: #27ae60;
    }
    #speakButton {
        background-color: #9b59b6;
    }
    #speakButton:hover {
        background-color: #8e44ad;
    }
    #queueList {
        margin-top: 20px;
        column-count: 4;
        column-gap: 20px;
        flex-grow: 1;
    }
    .queue-item {
        background-color: white;
        margin: 0 0 10px;
        padding: 10px;
        border-radius: 5px;
        transition: all 0.3s ease;
        break-inside: avoid-column;
        cursor: move;
    }
    .queue-item:hover {
        background-color: #e0e0e0;
    }
    .completed {
        color: #27ae60;
        font-weight: bold;
    }
    #fileInput {
        display: none;
    }
    #message {
        margin-top: 20px;
        font-size: 18px;
        color: #e74c3c;
        text-align: center;
    }
    .right-panel-buttons {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
    }
    .right-panel-buttons button {
        margin: 0 10px;
    }
    .sortable-ghost {
        opacity: 0.4;
    }
    #shortcutInfo {
        font-size: 14px;
        color: #7f8c8d;
        text-align: center;
        margin-top: 10px;
    }
    #customizeButton {
        background-color: #e67e22;
    }
    #customizeButton:hover {
        background-color: #d35400;
    }
    .customize-form {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .customize-form input, .customize-form select {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .customize-form button {
        width: 100%;
        border-radius: 4px;
    }
    #signature {
        position: fixed;
        bottom: 10px;
        right: 10px;
        font-size: 12px;
        color: #95a5a6;
        cursor: help;
    }
    #systemTitle {
        font-size: 48px;
        margin-top: 20px;
        margin-bottom: 30px;
        border: none;
        background-color: transparent;
        text-align: center;
        color: #2c3e50;
        width: 100%;
    }
    #systemTitle:focus {
        outline: none;
        border-bottom: 2px solid #3498db;
    }
    #autoCallInfo {
        font-size: 14px;
        color: #7f8c8d;
        text-align: center;
        margin-top: 10px;
    }
    .tooltip {
        position: relative;
        display: inline-block;
    }
    .tooltip .tooltiptext {
        visibility: hidden;
        width: 200px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -100px;
        opacity: 0;
        transition: opacity 0.3s;
    }
    .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
    }
    #resetButton {
        background-color: #e74c3c;
    }
    #resetButton:hover {
        background-color: #c0392b;
    }
</style>
</head>
<body>
    <div class="left-panel">
        <input type="text" id="systemTitle" value="双恒网络源码网叫号系统">
        <div class="current-info">
            <div id="currentPerson"><span class="label">当前：</span>准备开始</div>
            <div id="nextPerson"></div>
        </div>
        <div class="button-group">
            <button id="nextButton" title="下一位"><i class="fas fa-chevron-right"></i></button>
            <button id="speakButton" title="语音播报"><i class="fas fa-volume-up"></i></button>
            <button id="customizeButton" title="自定义"><i class="fas fa-cog"></i></button>
        </div>
        <div id="shortcutInfo">快捷键：→ (右箭头) 下一位, S 语音播报</div>
        <div id="autoCallInfo"></div>
        <div class="customize-form">
            <input type="text" id="roomNameInput" placeholder="房间名称">
            <select id="callModeSelect">
                <option value="manual">手动叫号</option>
                <option value="auto">自动叫号</option>
            </select>
            <input type="number" id="autoCallIntervalInput" placeholder="自动叫号间隔（分钟）" min="1">
            <button id="saveCustomization">保存设置</button>
        </div>
    </div>
    <div class="right-panel">
        <h2>人员列表</h2>
        <div class="right-panel-buttons">
            <button id="importButton" title="导入名单"><i class="fas fa-file-import"></i></button>
            <button id="shuffleButton" title="随机排序"><i class="fas fa-random"></i></button>
            <button id="resetButton" title="重置列表"><i class="fas fa-redo"></i></button>
        </div>
        <div id="queueList"></div>
        <div id="message"></div>
        <input type="file" id="fileInput" accept=".txt">
    </div>
    <div id="signature" class="tooltip">
        双恒网络源码网
        <span class="tooltiptext">欢迎关注公众号</span>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
    <script>
        let queue = [];
        let completedPersons = [];
        let currentIndex = -1;
        let isProcessing = false;
        let isShuffled = false;
        let roomName = "面试房间";
        let callMode = "manual";
        let autoCallInterval = 0;
        let autoCallTimeoutId = null;
        let originalQueue = [];

        function updateDisplay() {
            const queueList = $('#queueList');
            queueList.empty();
            queue.forEach((person, index) => {
                const item = $('<div>')
                    .addClass('queue-item')
                    .text(`${index + 1}. ${person}`)
                    .attr('data-index', index);
                queueList.append(item);
            });

            completedPersons.forEach((person) => {
                const item = $('<div>')
                    .addClass('queue-item completed')
                    .text(person);
                queueList.append(item);
            });

            if (currentIndex >= 0 && currentIndex < queue.length) {
                $('#currentPerson').html(`<span class="label">当前：</span>${queue[currentIndex]}`);
                if (currentIndex + 1 < queue.length) {
                    $('#nextPerson').html(`下一位：<span class="next-name">${queue[currentIndex + 1]}</span>`);
                } else {
                    $('#nextPerson').text('');
                }
            } else {
                $('#currentPerson').html('<span class="label">当前：</span>准备开始');
                $('#nextPerson').text('');
            }

            $('#nextButton').prop('disabled', currentIndex >= queue.length - 1 || isProcessing);

            if (isShuffled) {
                $('#message').text('已随机排序，请注意自己的顺序').show();
            } else {
                $('#message').text('').hide();
            }

            updateAutoCallInfo();
        }

        function updateAutoCallInfo() {
            if (callMode === 'auto' && autoCallInterval > 0) {
                $('#autoCallInfo').text(`自动叫号模式：每${autoCallInterval}分钟叫号一次`);
            } else {
                $('#autoCallInfo').text('手动叫号模式');
            }
        }

        function speakText(text) {
            return new Promise(resolve => {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.onend = resolve;
                speechSynthesis.speak(utterance);
            });
        }

        async function speakOnce(text) {
            await speakText(text);
        }

        async function nextPerson() {
            if (isProcessing) return;
            if (currentIndex < queue.length - 1) {
                isProcessing = true;
                if (currentIndex >= 0) {
                    completedPersons.push(queue[currentIndex]);
                    queue.splice(currentIndex, 1);
                }
                currentIndex = 0;
                updateDisplay();
                const personName = queue[currentIndex];
                await speakOnce(`请${personName}进入${roomName}。`);
                isProcessing = false;
                updateDisplay();
                if (callMode === 'auto') {
                    scheduleNextCall();
                }
            } else {
                alert('所有人员已完成');
                stopAutoCalling();
            }
        }

        function scheduleNextCall() {
            if (autoCallTimeoutId) {
                clearTimeout(autoCallTimeoutId);
            }
            autoCallTimeoutId = setTimeout(nextPerson, autoCallInterval * 60 * 1000);
        }

        function stopAutoCalling() {
            if (autoCallTimeoutId) {
                clearTimeout(autoCallTimeoutId);
                autoCallTimeoutId = null;
            }
        }

        function shuffleQueue() {
            for (let i = queue.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [queue[i], queue[j]] = [queue[j], queue[i]];
            }
            currentIndex = -1;
            isShuffled = true;
            updateDisplay();
        }

        async function speakCurrent() {
            if (isProcessing) return;
            if (currentIndex >= 0 && currentIndex < queue.length) {
                isProcessing = true;
                const personName = queue[currentIndex];
                await speakOnce(`请${personName}进入${roomName}。`);
                isProcessing = false;
                updateDisplay();
            }
        }

        function resetQueue() {
            if (confirm("确定要重置人员列表吗？这将清除所有已完成的记录。")) {
                queue = [...originalQueue];
                completedPersons = [];
                currentIndex = -1;
                isShuffled = false;
                stopAutoCalling();
                updateDisplay();
                initSortable();
            }
        }

        $('#nextButton').on('click', nextPerson);
        $('#shuffleButton').on('click', shuffleQueue);
        $('#speakButton').on('click', speakCurrent);
        $('#resetButton').on('click', resetQueue);
        $('#importButton').on('click', function() {
            $('#fileInput').click();
        });

        $('#fileInput').on('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    queue = content.split('\n').filter(name => name.trim() !== '');
                    originalQueue = [...queue];
                    completedPersons = [];
                    currentIndex = -1;
                    isShuffled = false;
                    updateDisplay();
                    initSortable();
                };
                reader.readAsText(file);
            }
        });

        $(document).on('click', '.queue-item', async function() {
            if (isProcessing) return;
            const clickedIndex = $(this).attr('data-index');
            if (clickedIndex !== undefined) {
                isProcessing = true;
                currentIndex = parseInt(clickedIndex);
                const personName = queue[currentIndex];
                $('#currentPerson').html(`<span class="label">当前：</span>${personName}`);
                $('#nextPerson').text('');
                await speakOnce(`请${personName}进入${roomName}。`);
                completedPersons.push(queue[currentIndex]);
                queue.splice(currentIndex, 1);
                currentIndex = -1;
                isProcessing = false;
                updateDisplay();
            }
        });

        function initSortable() {
            const queueList = document.getElementById('queueList');
            new Sortable(queueList, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: function(evt) {
                    const oldIndex = evt.oldIndex;
                    const newIndex = evt.newIndex;
                    const movedItem = queue.splice(oldIndex, 1)[0];
                    queue.splice(newIndex, 0, movedItem);
                    if (currentIndex === oldIndex) {
                        currentIndex = newIndex;
                    } else if (oldIndex < currentIndex && newIndex >= currentIndex) {
                        currentIndex--;
                    } else if (oldIndex > currentIndex && newIndex <= currentIndex) {
                        currentIndex++;
                    }
                    updateDisplay();
                }
            });
        }

        $(document).on('keydown', function(e) {
            if (e.key === "ArrowRight") {
                nextPerson();
            } else if (e.key === "s" || e.key === "S") {
                speakCurrent();
            }
        });

        $('#customizeButton').on('click', function() {
            $('.customize-form').toggle();
        });

        $('#saveCustomization').on('click', function() {
            roomName = $('#roomNameInput').val() || roomName;
            callMode = $('#callModeSelect').val();
            autoCallInterval = parseInt($('#autoCallIntervalInput').val()) || 0;
            $('.customize-form').hide();
            updateDisplay();
            if (callMode === 'auto' && autoCallInterval > 0) {
                scheduleNextCall();
            } else {
                stopAutoCalling();
            }
        });

        $('#systemTitle').on('input', function() {
            document.title = $(this).val();
        });

        $('#callModeSelect').on('change', function() {
            if ($(this).val() === 'auto') {
                $('#autoCallIntervalInput').show();
            } else {
                $('#autoCallIntervalInput').hide();
            }
        });

        updateDisplay();
        initSortable();
    </script>
</body></html>